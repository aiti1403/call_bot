# Срочный вызов на смену - Telegram Bot

Телеграм-бот для организации срочных вызовов сотрудников на смену. Позволяет администраторам (ПДО, начальникам смен) создавать заявки на срочный вызов сотрудников определенных категорий, а сотрудникам - откликаться на эти заявки.

## Функциональность

### Для администраторов:
- Создание заявок на срочный вызов сотрудников
- Указание площадки, участка, даты и времени смены
- Выбор категории и количества требуемых сотрудников
- Просмотр и управление активными заявками
- Получение уведомлений о новых откликах
- Отмена заявок с автоматическим уведомлением сотрудников

### Для сотрудников:
- Получение уведомлений о срочных вызовах по своей категории
- Возможность откликнуться на заявку
- Получение подтверждения о записи на смену

## Технические требования

- Python 3.7+
- aiogram 3.x
- SQLite3

## Установка и запуск

1. Клонируйте репозиторий:
```bash
git clone <url-репозитория>
cd <директория-проекта>
```

2. Установите зависимости:
```bash
pip install -r requirements.txt
```

3. Настройте токен бота и список администраторов в файле скрипта.

4. Запустите бота:
```bash
python bot.py
```

## Команды бота

### Для всех пользователей:
- `/start` - начать работу с ботом
- `/help` - показать справку

### Для администраторов:
- `/add_admin @username` - добавить администратора
- `/add_employee ID Имя_Фамилия Категория` - добавить сотрудника
- `/set_employee_category @username Категория` - установить категорию сотрудника
- `/stats` - просмотр статистики по категориям
- `/check_category Категория` - проверить сотрудников в категории
- `/check_user ID` - проверить информацию о пользователе
- `/fix_category ID Категория` - исправить категорию пользователя
- `/normalize_categories` - нормализовать категории в базе данных
- `/debug_db` - диагностика базы данных

## Структура базы данных

### Таблица users
- `id` - первичный ключ
- `user_id` - ID пользователя в Telegram
- `username` - имя пользователя в Telegram
- `full_name` - полное имя сотрудника
- `category` - категория сотрудника
- `is_admin` - флаг администратора

### Таблица requests
- `id` - первичный ключ
- `creator_id` - ID создателя заявки
- `location` - площадка
- `department` - участок
- `shift_date` - дата смены
- `shift_time` - время смены
- `employees_needed` - требуемое количество сотрудников
- `employee_category` - категория требуемых сотрудников
- `note` - примечание к заявке
- `status` - статус заявки
- `created_at` - время создания заявки

### Таблица responses
- `id` - первичный ключ
- `request_id` - ID заявки
- `user_id` - ID откликнувшегося сотрудника
- `status` - статус отклика
- `responded_at` - время отклика

## Процесс работы

1. Администратор создает заявку на срочный вызов
2. Бот автоматически рассылает уведомления всем сотрудникам выбранной категории
3. Сотрудники могут откликнуться на заявку
4. Администратор получает уведомления о новых откликах
5. Когда набирается нужное количество сотрудников, администратор видит полный список

## Примечания по безопасности

- Токен бота следует хранить в безопасном месте
- Рекомендуется использовать переменные окружения для хранения токена
- Регулярно делайте резервные копии базы данных

## Поддержка

При возникновении проблем или вопросов обращайтесь к администратору системы.